# Fall Core 版本同步工具 (Dart版本)

## 概述

`sync_version.dart` 是一个用于统一更新 Fall Core 框架所有模块版本号的 Dart 脚本，替代了原有的批处理脚本，提供更可靠、跨平台的版本管理功能。

## 功能特性

✅ **自动版本检测**: 扫描并显示所有模块的当前版本号  
✅ **版本格式验证**: 确保输入的版本号符合语义化版本规范  
✅ **批量版本更新**: 一次性更新所有模块的版本号  
✅ **依赖关系同步**: 自动更新模块间的依赖版本  
✅ **备份与恢复**: 自动备份原文件，支持失败回滚  
✅ **详细日志输出**: 提供清晰的操作状态和结果反馈  
✅ **跨平台兼容**: Windows、macOS、Linux 均可使用  

## 使用方法

### 基本用法

```bash
# 在项目根目录执行
dart scripts/sync_version.dart
```

### 执行流程

1. **检查环境**: 验证是否在正确的项目根目录
2. **显示当前版本**: 列出所有模块的当前版本号
3. **输入新版本**: 提示用户输入新的版本号（格式：x.y.z）
4. **版本验证**: 验证输入的版本号格式是否正确
5. **批量更新**: 依次更新所有模块的版本号
6. **依赖同步**: 更新模块间的依赖版本关系
7. **结果汇总**: 显示更新结果和下一步建议

### 示例输出

```
=========================
 Fall Core 版本同步脚本
=========================

📋 [信息] 当前版本号:
  📦 fall_core_base: 0.0.2
  📦 fall_core_gen: 0.0.2
  📦 fall_core_main: 0.0.2

请输入新的版本号 (格式: x.y.z): 
0.0.3

📝 [信息] 将所有模块版本号更新为: 0.0.3
========================================
[更新] fall_core_base...
  ✅ fall_core_base: 成功更新到 0.0.3
[更新] fall_core_gen...
  ✅ fall_core_gen: 成功更新到 0.0.3
[更新] fall_core_main...
  ✅ fall_core_main: 成功更新到 0.0.3

📦 更新模块间依赖关系...
========================================
  ✅ fall_core_gen: 已更新 fall_core_base 依赖至 ^0.0.3
  ✅ fall_core_main: 已更新 fall_core_base 依赖至 ^0.0.3

==========================================
 🎉 版本同步完成！
==========================================
```

## 模块依赖关系

脚本会自动处理以下依赖关系：

- `fall_core_gen` → `fall_core_base`
- `fall_core_main` → `fall_core_base`

更新版本时，会同步更新依赖模块的版本约束。

## 错误处理

- **目录检查**: 确保在正确的项目根目录执行
- **文件备份**: 更新前自动备份 `pubspec.yaml` 文件
- **版本验证**: 检查版本号格式和更新结果
- **错误回滚**: 失败时保留备份文件供手动恢复

## 版本要求

- **Dart SDK**: 2.12.0 或更高版本
- **操作系统**: Windows、macOS、Linux
- **项目结构**: 标准的 Fall Core 多模块项目结构

## 与批处理脚本的对比

| 特性 | Dart 脚本 | 批处理脚本 |
|------|-----------|------------|
| 跨平台支持 | ✅ | ❌ (仅Windows) |
| 错误处理 | ✅ 完善 | ⚠️ 有限 |
| 版本验证 | ✅ 内置 | ⚠️ 基础 |
| 依赖更新 | ✅ 自动 | ✅ 自动 |
| 可读性 | ✅ 高 | ⚠️ 中等 |
| 维护性 | ✅ 高 | ⚠️ 中等 |

## 后续步骤

版本同步完成后，建议按以下顺序操作：

1. **提交变更**:
   ```bash
   git add .
   git commit -m "chore: bump version to x.y.z"
   ```

2. **更新 CHANGELOG**: 为各模块更新版本日志

3. **发布包**: 运行发布脚本
   ```bash
   dart scripts/publish.dart  # 或 scripts/publish.bat
   ```

4. **验证依赖**: 检查依赖关系
   ```bash
   flutter pub deps
   ```

## 故障排除

### 常见问题

**Q: 提示"请在项目根目录执行此脚本"**  
A: 确保在包含 `fall_core_base`、`fall_core_gen`、`fall_core_main` 三个目录的根目录执行

**Q: 版本更新失败**  
A: 检查 `pubspec.yaml` 文件权限，确保可写入。备份文件位于各模块的 `pubspec.yaml.bak`

**Q: 依赖更新不正确**  
A: 手动检查各模块的 `pubspec.yaml` 中的 `fall_core_base` 依赖版本

### 日志级别

脚本提供详细的操作日志：
- ✅ 成功操作
- ❌ 失败操作  
- ⚠️ 警告信息
- 📦 版本信息
- 🔗 依赖关系

## 开发信息

- **文件位置**: `scripts/sync_version.dart`
- **替代文件**: `scripts/sync_version.bat`
- **维护者**: Fall Core 团队
- **更新时间**: 2025-09-13